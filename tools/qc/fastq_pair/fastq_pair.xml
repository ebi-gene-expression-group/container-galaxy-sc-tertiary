<tool id="fastq_pair" name="Paired-end fastq pairer" profile="18.01" version="1.0+galaxy0">
    <description>Rewrite paired-end fastq files to make sure that all reads have a mate and to separate out singletons.</description>
    <requirements>
        <requirement type="package" version="1.0">fastq-pair</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[


    ## Unzip gzipped inputs
    #set fastq1_lw = str($fastq1).lower()
    #set fastq2_lw = str($fastq2).lower()

    #if fastq1_lw.endswith((".gz", ".gzip")):
        gzip -d -c $fastq1 > 1.fq &&
    #else:
        mv '$fastq1' 1.fq &&
    #end if

    #if fastq2_lw.endswith((".gz", ".gzip")):
         gzip -d -c $fastq2 > 2.fq &&
    #else:
        mv '$fastq2' 2.fq &&
    #end if


    ## Run fastq_pair
    fastq_pair

    #if $table_size:
        -t '$table_size'
    #end if

    #if $print_elements:
        -p '$print_elements'
    #end if

    #if $verbose:
        '$verbose'
    #end if

    1.fq 2.fq 

    ]]></command>
    <inputs>
        <param name="verbose" label="Verbose" optional="true" value="false" argument="-v" type="boolean" truevalue="-v" falsevalue="" checked="true" help="Verbose output. This is mainly for debugging." />
        <param name="fastq1" label="FASTQ file 1" type="data" format="fastqsanger" optional="false" help="FASTQ file input, file 1 of pair" />
        <param name="fastq2" label="FASTQ file 2" type="data" format="fastqsanger" optional="false" help="FASTQ file input, file 2 of pair" />
        <param name="table_size" label="Table size" argument="-t" optional="true" value="100003" type="integer" help="Table size (default 100003)" />
        <param name="print_elements" label="Number elements to print" argument="-p" type="integer" optional="true" help="Print this number of elements in each bucket in the table." />
    </inputs>
    <outputs>        
        <collection name="paired" type="list" format_source="fastq1" label="${tool.name} on ${on_string}: Paired reads">
            <data name="forward" from_work_dir="1.fq.paired.fq" />
            <data name="reverse" from_work_dir="2.fq.paired.fq" />
        </collection>
        <collection name="singletons" type="list" format_source="fastq1" label="${tool.name} on ${on_string}: Singletons">
            <data name="forward" from_work_dir="1.fq.single.fq" />
            <data name="reverse" from_work_dir="2.fq.single.fq" />
        </collection>
    </outputs>
    <tests>
        <!--test>
            <param name="table_size" value="1000"/>
            <param name="fastq1" value="left.fastq"/>
            <param name="fastq2" value="right.fastq"/>
            <output_collection name="paired" type="list" count="2">
                <element name="forward" ftype="fastqsanger">
                    <assert_contents><has_line_matching expression="^@GFH7CG303GRT2I/1[ -~]+" /></assert_contents>
                </element>
                <element name="reverse" ftype="fastqsanger">
                    <assert_contents><has_line_matching expression="^@GFH7CG303GRT2I/2[ -~]+" /></assert_contents>
                </element>
            </output_collection>
            <output_collection name="singletons" type="list" count="2">
                <element name="forward" ftype="fastqsanger">
                    <assert_contents><has_line_matching expression="^@GFH7CG303GGIBL/1[ -~]+" /></assert_contents>
                </element>
                <element name="reverse" ftype="fastqsanger">
                    <assert_contents><has_line_matching expression="^@GFH7CG303GSASH/2[ -~]+" /></assert_contents>
                </element>
            </output_collection>
        </test-->
        <test>
            <param name="table_size" value="1000"/>
            <param name="fastq1" value="left.fastq.gz"/>
            <param name="fastq2" value="right.fastq.gz"/>
            <output_collection name="paired" type="list" count="2">
                <element name="forward" ftype="fastqsanger">
                    <assert_contents><has_line_matching expression="^@GFH7CG303GRT2I/1[ -~]+" /></assert_contents>
                </element>
                <element name="reverse" ftype="fastqsanger">
                    <assert_contents><has_line_matching expression="^@GFH7CG303GRT2I/2[ -~]+" /></assert_contents>
                </element>
            </output_collection>
            <output_collection name="singletons" type="list" count="2">
                <element name="forward" ftype="fastqsanger">
                    <assert_contents><has_line_matching expression="^@GFH7CG303GGIBL/1[ -~]+" /></assert_contents>
                </element>
                <element name="reverse" ftype="fastqsanger">
                    <assert_contents><has_line_matching expression="^@GFH7CG303GSASH/2[ -~]+" /></assert_contents>
                </element>
            </output_collection>
        </test>
    </tests>
    <help><![CDATA[
=======================================================
Paired-end fastq pairer (fastq_pair)
=======================================================

Match up paired end fastq files quickly and efficiently. 

fastq_pair [options] [fastq file 1] [fastq file 2]

OPTIONS
-t table size (default 100003)
-p print the number of elements in each bucket in the table
-v verbose output. This is mainly for debugging
]]></help>
    <citations>
        <citation type="doi">10.1101/552885</citation>
    </citations>
</tool>
