<?xml version="1.0" encoding="utf-8"?>
<tool id="convert-ftype" name="Rdata to Anndata conversion" version="v0.0.1+galaxy0">
  <requirements>
    <requirement type="package" version="2.3.1">r-seurat</requirement>
  </requirements>
  <description>Convert Seurat object in Rdata format to Scanpy object in Anndata HDF5 format</description>
  <command detect_errors="exit_code"><![CDATA[
ln -s '${input_rds}' input.rds &&
Rscript ${script_file}
]]></command>

  <configfiles>
    <configfile name="script_file"><![CDATA[
suppressPackageStartupMessages(library(Seurat))
rds <- readRDS('input.rds')
Convert(from=rds, to='anndata', filename='output.h5')
]]></configfile>
  </configfiles>

  <inputs>
    <param name="input_rds" type="data" format="rdata" label="Seurat object in Rdata format" help=""/>
  </inputs>

  <outputs>
    <data name="output_h5" format="h5" from_work_dir="output.h5" label="${tool.name} on ${on_string} anndata.h5"/>
  </outputs>

  <tests>
    <test>
      <param name="input_rds" value="pbmc3k_final.rds"/>
      <output name="output_h5" file="pbmc3k_final.h5ad" ftype="h5" compare="sim_size"/>
    </test>
  </tests>

  <help><![CDATA[
Rdata to Anndata Conversion
---------------------------

Convert Seurat producted object in Rdata format to Anndata HDF5 format.

To use it, choose in the history the Seurat-generated Rdata object and click "Execute".

For more information, check https://satijalab.org/seurat/new-features and https://anndata.readthedocs.io/en/latest/
]]></help>
</tool>
